{% extends '_layouts/cp' %}

{% set title = 'Sprig Playground'|t('sprig') %}

{% set bundle = view.registerAssetBundle('putyourlightson\\sprig\\assets\\PlaygroundAsset') %}
{% set resourcesUrl = bundle.baseUrl %}

{% block pageTitle %}

    <div style="width: 54px;">
        {{ svg(craft.app.plugins.getPluginIconSvg('sprig')) }}
    </div>

    {{ parent() }}

{% endblock %}

{% block contextMenu %}

    <div id="context-btngroup" class="btngroup">
        <button type="button" id="context-btn" class="btn menubtn">
            <span id="revision-label">{{ playground ? playground.name : 'New' }}</span>
        </button>
        <div class="menu">
            <ul class="padded">
                <li>
                    <a href="{{ url('sprig') }}" class="{{ playground is null ? 'sel' }}">
                        New
                    </a>
                </li>
                {% for curPlayground in allPlaygrounds %}
                    <li>
                        <a href="{{ url('sprig/' ~ curPlayground.id) }}" class="{{ playground and playground.id == curPlayground.id ? 'sel' }}">
                            {{ curPlayground.name }}
                        </a>
                    </li>
                {% endfor %}
            </ul>
        </div>
    </div>

    {% if not craft.app.config.general.devMode %}
        <span class="info warning" title="devMode is not enabled">
            {{ 'Enable devMode to see Twig template errors.'|t('sprig') }}
        </span>
    {% endif %}

{% endblock %}


{% block actionButton %}

    <form id="action-form" method="post">

        {{ csrfInput() }}
        <input type="hidden" name="action" value="sprig/playground/save">
        <input type="hidden" name="id" value="{{ playground ? playground.id }}">
        <input type="hidden" name="name" value="">
        <textarea name="component" class="hidden"></textarea>
        <textarea name="variables" class="hidden"></textarea>

        <div class="flex">
            <a href="https://putyourlightson.com/plugins/sprig" class="btn" target="_blank">{{ 'Docs'|t('sprig') }}</a>
            <a href="https://putyourlightson.com/sprig-cookbook" class="btn" target="_blank">{{ 'Cookbook'|t('sprig') }}</a>

            {% if playground %}
                <div class="btngroup">
                    <button type="button" class="btn submit formsubmit" data-action="sprig/playground/update">{{ 'Update'|t('sprig') }}</button>
                    <button type="button" class="btn submit menubtn"></button>
                    <div class="menu">
                        <ul>
                            <li>
                                <a class="formsubmit">{{ 'Save as a new playground'|t('sprig') }}</a>
                            </li>
                        </ul>
                        <hr>
                        <ul>
                            <li>
                                <a class="formsubmit error" data-action="sprig/playground/delete" data-confirm="{{ 'Are you sure you want to delete this playground?'|t('sprig') }}">{{ 'Delete playground'|t('sprig') }}</a>
                            </li>
                        </ul>
                    </div>
                </div>
            {% else %}
                <button type="button" class="btn submit formsubmit">{{ 'Save'|t('sprig') }}</button>
            {% endif %}
        </div>

    </form>

{% endblock %}


{% block main %}

    <div class="playground">
        <div>
            <div class="pane">
                <p class="light code">{{ 'Component'|t('sprig') }}</p>
                <div id="editor" class="editor"></div>
                <textarea id="input" class="hidden">
                    {%- if playground -%}
                        {{ playground.component }}
                    {%- else -%}
                        {%- verbatim -%}
<h1>
    Hello, {{ currentUser.friendlyName }}!
</h1>

<button sprig s-val:count="{{ count + 1 }}" class="btn submit">
    Re-render
</button>

<p>
    <em>Component re-rendered {{ count }} times</em>
</p>
                        {%- endverbatim -%}
                    {%- endif -%}
                </textarea>
                <button id="create" type="submit" class="btn submit topright">{{ 'Create'|t('sprig') }}</button>
            </div>
            <div class="variables content-pane">
                <p class="light code">{{ 'Component Variables'|t('sprig') }}</p>
                {% set variables = playground ? playground.variables : 'count=0' %}
                <input id="input-variables" class="input code fullwidth field" value="{{ variables }}" placeholder="x=1,y=2,z=3">
            </div>
        </div>

        <div>
            <div class="output pane">
                <p class="light code">
                    {{ 'Output'|t('sprig') }}
                    <span id="spinner" class="spinner" style="display: none;"></span>
                </p>
                <a href="#" id="output-toggle" class="btn topright">&lt; &gt;</a>
                {{ sprig('SprigPlayground', {}, {id: 'playground'}) }}
                <textarea id="sourcecode" class="code fullwidth field" style="display: none;" disabled></textarea>
            </div>
            <div class="variables content-pane">
                <p class="light code">{{ 'Output Variables'|t('sprig') }}</p>
                <input id="output-variables" class="input code fullwidth field" value="" disabled>
            </div>
        </div>
    </div>

    {{ sprig.script }}
    {{ sprig.hyperscript }}

    {% js %}
        let resourcesUrl = '{{ resourcesUrl }}';
    {% endjs %}

{% endblock %}
